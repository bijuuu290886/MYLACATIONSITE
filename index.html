<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLocation Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <header>
            <h1>GeoLocation Tracker</h1>
            <p>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö</p>
        </header>

        <main>
            <section class="features">
                <div class="feature-card">
                    <div class="icon">üìç</div>
                    <h3>–¢–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</h3>
                    <p>–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                </div>
                <div class="feature-card">
                    <div class="icon">‚ö°</div>
                    <h3>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</h3>
                    <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üîí</div>
                    <h3>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h3>
                    <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º</p>
                </div>
            </section>

            <section class="map-section">
                <h2>–í–∞—à–µ —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h2>
                <div id="map"></div>
                <div class="status">
                    <p id="location-status">–°—Ç–∞—Ç—É—Å: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ</p>
                    <p id="coordinates">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –ù–µ –¥–æ—Å—Ç—É–ø–Ω—ã</p>
                    <p id="accuracy">–¢–æ—á–Ω–æ—Å—Ç—å: –ù–µ –¥–æ—Å—Ç—É–ø–Ω–∞</p>
                </div>
                <div class="controls">
                    <button id="start-tracking" class="btn primary">–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</button>
                    <button id="stop-tracking" class="btn secondary" disabled>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button id="share-location" class="btn accent" disabled>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º</button>
                </div>
            </section>
        </main>

        <footer>
            <p>¬© 2023 GeoLocation Tracker | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        let watchId = null;
        let marker = null;
        let circle = null;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const startBtn = document.getElementById('start-tracking');
        const stopBtn = document.getElementById('stop-tracking');
        const shareBtn = document.getElementById('share-location');
        const locationStatus = document.getElementById('location-status');
        const coordinatesDisplay = document.getElementById('coordinates');
        const accuracyDisplay = document.getElementById('accuracy');

        // –§—É–Ω–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        function success(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            locationStatus.textContent = '–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ';
            coordinatesDisplay.textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –®–∏—Ä–æ—Ç–∞ ${lat.toFixed(6)}, –î–æ–ª–≥–æ—Ç–∞ ${lng.toFixed(6)}`;
            accuracyDisplay.textContent = `–¢–æ—á–Ω–æ—Å—Ç—å: ¬±${Math.round(accuracy)} –º–µ—Ç—Ä–æ–≤`;

            // –ï—Å–ª–∏ –º–∞—Ä–∫–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (marker) {
                map.removeLayer(marker);
            }
            
            // –ï—Å–ª–∏ –∫—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–¥–∞–ª—è–µ–º –µ–≥–æ
            if (circle) {
                map.removeLayer(circle);
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
            marker = L.marker([lat, lng]).addTo(map)
                .bindPopup("–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –∑–¥–µ—Å—å").openPopup();

            // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π —Ç–æ—á–Ω–æ—Å—Ç—å
            circle = L.circle([lat, lng], {
                color: '#4a6fa5',
                fillColor: '#4a6fa5',
                fillOpacity: 0.2,
                radius: accuracy
            }).addTo(map);

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —Ç–µ–∫—É—â–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
            map.setView([lat, lng], 15);
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
            shareBtn.disabled = false;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
            locationStatus.textContent = `–°—Ç–∞—Ç—É—Å: –û—à–∏–±–∫–∞ (${err.message})`;
            
            if (err.code === 1) {
                alert("–û—à–∏–±–∫–∞: –î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.");
            } else {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è: " + err.message);
            }
        }

        // –û–ø—Ü–∏–∏ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        const options = {
            enableHighAccuracy: true,
            maximumAge: 0
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ"
        startBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                watchId = navigator.geolocation.watchPosition(success, error, options);
                locationStatus.textContent = '–°—Ç–∞—Ç—É—Å: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...';
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                locationStatus.textContent = '–°—Ç–∞—Ç—É—Å: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º';
                alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º");
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
        stopBtn.addEventListener('click', () => {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
                locationStatus.textContent = '–°—Ç–∞—Ç—É—Å: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                shareBtn.disabled = true;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º"
        shareBtn.addEventListener('click', () => {
            if (marker) {
                const latlng = marker.getLatLng();
                const url = `https://www.openstreetmap.org/?mlat=${latlng.lat}&mlon=${latlng.lng}#map=16/${latlng.lat}/${latlng.lng}`;
                alert(`–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${url}\n–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–º.`);
            }
        });
    </script>
</body>
</html>